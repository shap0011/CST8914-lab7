<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Feedback form (Accessible)</title>
    <meta charset="utf-8" />
    <style>
      .control,
      fieldset {
        margin: 6px 0;
      }

      label {
        display: inline-block;
        width: 120px;
        vertical-align: top;
      }

      input + label {
        width: auto;
      }

      .error,
      .required {
        color: red;
      }

      fieldset ul {
        margin: 0;
      }

      /* Visually hidden utility for screen reader only instructions */
      .sr-only {
        position: absolute;
        height: 1px;
        width: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip-path: inset(50%);
        white-space: nowrap;
      }

      /* Clear, visible focus for keyboard users */
      :focus-visible {
        outline: 3px solid #ffbf47;
        outline-offset: 2px;
      }

      /* Error summary styling */
      fieldset.errors {
        border: 2px solid #c00;
        padding: 8px 12px;
      }

      fieldset.errors legend {
        font-weight: bold;
        color: #c00;
      }

      fieldset.errors a {
        text-decoration: underline;
      }

      /* Make inline help text slightly muted for sighted users */
      .help {
        display: block;
        font-size: 0.95rem;
        color: #444;
        margin-left: 120px;
      }
    </style>
  </head>
  <body>
    <h1>Feedback form</h1>

    <!-- Q2-3. Identifying required fields in text -->
    <p>
      <strong
        >All fields marked with
        <span class="required" aria-hidden="true">*</span> are required.</strong
      >
      <span class="sr-only"
        >Required fields are indicated by the word "required".</span
      >
    </p>

    <!-- Added method/action for clarity; novalidate so our custom JS demo runs consistently -->
    <form method="get" action="" novalidate>
      <div class="control">
        <!-- Q2-1. Proper label association: add for/id.
             Q2-2. Indicate required in text & programmatically.
             Q2-4. Add required + aria-describedby for inline instructions. -->
        <label for="name"
          >Full name <span class="required" aria-hidden="true">*</span>
          <span class="sr-only">(required)</span></label
        ><input
          id="name"
          name="name"
          type="text"
          required
          autocomplete="name"
          aria-describedby="name_help"
        />
        <!-- Inline instruction visible and announced -->
        <span id="name_help" class="help">Enter your first and last name.</span>
      </div>
      <div class="control">
        <label>Biography</label
        ><textarea id="biography" name="biography" type="text"></textarea>
        <span>Include examples on your skills in JavaScript.</span>
      </div>

      <div>Gender</div>
      <div class="control">
        <input id="gender_male" name="gender" type="radio" value="male" /><label
          >Male</label
        >
      </div>
      <div class="control">
        <input
          id="gender_female"
          name="gender"
          type="radio"
          value="female"
        /><label>Female</label>
      </div>

      <div class="control">
        <input
          id="accept_agbs"
          name="accept_agbs"
          type="checkbox"
          value="1"
        /><label>I accept the terms and conditions</label>
      </div>
      <div class="control">
        <input name="validate" type="hidden" value="1" /><input
          type="submit"
          value="Register"
        />
      </div>
    </form>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <script>
      "use strict";

      (function () {
        var validateInput;

        $.urlParam = function (name) {
          var results;
          results = new RegExp("[?&]" + name + "=([^&#]*)").exec(
            window.location.href
          );

          if (results === null) {
            return null;
          } else {
            return decodeURI(results[1]) || null;
          }
        };

        validateInput = function validateInput(input, message) {
          var $elementToDescribe,
            $error,
            $errorContainer,
            $fieldset,
            $input,
            $referencedElement,
            value;
          $input = $('[name="' + input + '"]');

          if ((value = $.urlParam(input)) === null) {
            if ($("fieldset.errors").length === 0) {
              $("form").prepend(
                '<fieldset class="errors"><legend>Errors</legend><ul></ul></fieldset>'
              );
            }

            $referencedElement = null;
            $elementToDescribe = null;
            $errorContainer = $("fieldset.errors ul");

            if ($input.is(":radio")) {
              $fieldset = $input.closest("fieldset");
              $elementToDescribe = $fieldset;
              $referencedElement = $input.filter(":first");
            } else {
              $elementToDescribe = $input;
              $referencedElement = $input;
            }
            // R.G. hint: fix next line ;)
            $error = $("<a>" + message + "</a>");
            $error.click(function (e) {
              // If we rely on the link's href pointing to the input's ID, it doesn't trigger forms mode in screen readers
              $referencedElement.focus();
              return e.preventDefault();
            });
            $elementToDescribe.attr("aria-describedby", input + "_description");
            $errorContainer.append("<li>").find("li:last").append($error);

            if ($(":not(form):focus").length === 0) {
              // See https://stackoverflow.com/questions/46134247/jquery-setting-focus-doesnt-work-in-ie11/
            }
          } else {
            if ($input.is(":checkbox")) {
              $input.attr("checked", true);
            }

            if ($input.is(":radio")) {
              return $input
                .filter('[value="' + value + '"]')
                .attr("checked", true);
            } else {
              return $input.val(value);
            }
          }
        };

        $(document).ready(function () {
          if ($.urlParam("validate")) {
            validateInput("name", "Please enter your name!");
            validateInput(
              "biography",
              "Please tell us something about your history!"
            );
            validateInput("gender", "Please tell us your gender!");
            validateInput(
              "accept_agbs",
              "You must accept our terms and conditions!"
            );

            if ($(".error").length === 0) {
              return alert("All inputs are valid.");
            }
          }
        });
      }).call(void 0);
    </script>
  </body>
</html>
